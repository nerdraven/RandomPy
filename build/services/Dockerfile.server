FROM node:16.0.0-slim as build

WORKDIR /usr/src/app

COPY *.json /usr/src/app/
COPY yarn.lock .
COPY package.json .

RUN yarn install

COPY src/ /usr/src/app/src/
RUN yarn build

FROM node:16.0.0-slim

WORKDIR /usr/src/app

COPY --from=build /usr/src/app/dist/server .
COPY --from=build /usr/src/app/package.json .
COPY --from=build /usr/src/app/node_modules/ node_modules/

ENTRYPOINT [ "yarn", "start" ]